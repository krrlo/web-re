<!DOCTYPE html>
<html>

<head>
	<meta charset="UTF-8">
	<title>student/studentInfo.html</title>
</head>


<body>

	<div id="show">
		<table border="1">
			<thead>
				<tr>
					<th>아이디</th>
					<th>이름</th>
					<th>생년월일</th>
					<th>삭제</th>
				</tr>
			</thead>
			<tbody id="list">
			</tbody>
		</table>
	</div>
	<script>
		//페이지 로딩되면서 바로 실행되는 코드...........
		fetch('../studentList.do')
			.then(resolve => resolve.json())     //자바객체타입으로바꿈 
			.then(result => {
				console.log(result);     //서블릿에서..../studentList.do 에서 제이슨타입으로 바꾼 값들이 들어가있음  이걸로 페이지 만드는게 목적............
				let tbody =document.querySelector('#list');
				result.forEach(student =>{
				tbody.append(makeTr(student));  
					
				})
			})
			.catch(err => console.log('에러', err))


		function makeTr(obj) {   //학생 객체 하나가 들어옴 
			let showF =['studentId' , 'studentName' , 'studentBirthday'];
			
			let tr = document.createElement('tr')
			for (let prop of showF) {                		
				let td = document.createElement('td')
				td.innerHTML = obj[prop];            
				tr.append(td);
			}
			
			//삭제버튼.
			let td = document.createElement('td');
			let btn =document.createElement('button');
			btn.setAttribute('data-sid' , obj.studentId);    //버튼에 sid를 담아놓음 ... 삭제할때 쓸려고 
			btn.innerHTML = '삭제';
			btn.addEventListener('click', function(e){            //버튼을 클릭하면 삭제.. 
				//ajax호출 -> 서블릿 실행 
				fetch('../delStudent.do?sid=' + obj.studentId)
				.then(resolve => resolve.json())
				.then(result => {
					console.log(result);
					if(result.retCode == 'OK'){
						alert('삭제성공');
						tr.remove();
					}else{
						alert('삭제실패');
					}
				})
				.catch(err => console.log('에러' + err))
			})
			td.append(btn);
			tr.append(td);			
			return tr;
			
			
			/*let tr = document.createElement('tr')
			for (let prop in showF) {                		
				let td = document.createElement('td')
				td.innerHTML = obj[showF[prop]];            
				tr.append(td);
			}
			return tr;*/
		}//maketr
		
	</script>

</body>

</html>